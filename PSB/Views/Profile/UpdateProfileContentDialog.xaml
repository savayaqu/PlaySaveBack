<?xml version="1.0" encoding="utf-8"?>
<ContentDialog
    x:Class="PSB.Views.Profile.UpdateProfileContentDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:PSB.Views.Profile"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    Title="Редактирование профиля">
    <ContentDialog.Resources>
        <x:Double x:Key="ContentDialogMaxWidth">800</x:Double>
        <x:Double x:Key="ContentDialogMinWidth">800</x:Double>
        <x:Double x:Key="ContentDialogMaxHeight">600</x:Double>
        <x:Double x:Key="ContentDialogMinHeight">600</x:Double>
    </ContentDialog.Resources>
    <StackPanel>
        <Button BorderThickness="0" Background="Transparent" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,-40,0,0" Click="Button_Click">
            <FontIcon HorizontalAlignment="Center" VerticalAlignment="Center" Glyph="&#xE711;" />
        </Button>
        <Button 
            BorderThickness="0" 
            Background="Transparent" 
            HorizontalAlignment="Right" 
            VerticalAlignment="Top" 
            Margin="0,-40,0,0" 
            Click="Button_Click">
            <FontIcon Glyph="&#xE711;" />
        </Button>

        <!-- Аватар (поле + кнопка выбора) -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Превью аватара -->
            <Image
                Height="150"
                Width="150"
                Stretch="Fill"
                Source="{x:Bind UpdateProfileViewModel.CurrentAvatar, Mode=OneWay}"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"/>

            <!-- Кнопка с Flyout для выбора способа загрузки -->
            <Button
                Grid.Column="1"
                HorizontalAlignment="Right"
                VerticalAlignment="Center"
                Margin="8,0,0,0">
                <FontIcon Glyph="&#xE70F;" />
                <Button.Flyout>
                    <MenuFlyout Placement="Bottom">
                        <MenuFlyoutItem 
                            Text="Выбрать файл" 
                            Command="{x:Bind UpdateProfileViewModel.PickAvatarFileCommand}"/>
                        <MenuFlyoutItem 
                            Text="Вставить ссылку (URL)"
                            Command="{x:Bind UpdateProfileViewModel.ShowAvatarUrlInputCommand}"/>
                    </MenuFlyout>
                </Button.Flyout>
            </Button>
        </Grid>

        <!-- Поле для URL аватара (появляется только после выбора "Вставить ссылку") -->
        
        <!-- Поле для URL хедера (появляется только после выбора "Вставить ссылку") -->
        <Grid ColumnSpacing="6" ColumnDefinitions="*,Auto"  Visibility="{x:Bind UpdateProfileViewModel.IsAvatarUrlInputVisible, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=False}" HorizontalAlignment="Stretch" VerticalAlignment="Center">
            <TextBox 
    x:Name="AvatarUrlTextBox"
    Header="Ссылка на аватар (URL)"
    PlaceholderText="https://example.com/avatar.jpg"
    Text="{x:Bind UpdateProfileViewModel.AvatarUrl, Mode=TwoWay}"  Grid.Column="0"/>
            <Button Grid.Column="1" Command="{x:Bind UpdateProfileViewModel.ConfirmAvatarUrlCommand, Mode=OneWay}" VerticalAlignment="Bottom">
                <FontIcon Glyph="&#xE8FB;" />
            </Button>
        </Grid>
        <!-- Хедер (поле + кнопка выбора) -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Превью хедера -->
            <Image
                Height="150"
                Width="150"
                Stretch="Fill"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Source="{x:Bind UpdateProfileViewModel.CurrentHeader, Mode=OneWay}"/>

            <!-- Кнопка с Flyout для выбора способа загрузки -->
            <Button
                Grid.Column="1"
                HorizontalAlignment="Right"
                VerticalAlignment="Center"
                Margin="8,0,0,0">
                <FontIcon Glyph="&#xE70F;" />
                <Button.Flyout>
                    <MenuFlyout Placement="Bottom">
                        <MenuFlyoutItem 
                            Text="Выбрать файл" 
                            Command="{x:Bind UpdateProfileViewModel.PickHeaderFileCommand}"/>
                        <MenuFlyoutItem 
                            Text="Вставить ссылку (URL)"
                            Command="{x:Bind UpdateProfileViewModel.ShowHeaderUrlInputCommand}"/>
                    </MenuFlyout>
                </Button.Flyout>
            </Button>
        </Grid>

        <!-- Поле для URL хедера (появляется только после выбора "Вставить ссылку") -->
        <Grid ColumnSpacing="6" ColumnDefinitions="*,Auto"  Visibility="{x:Bind UpdateProfileViewModel.IsHeaderUrlInputVisible, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=False}" HorizontalAlignment="Stretch" VerticalAlignment="Center">
            <TextBox 
    Header="Ссылка на хедер (URL)"
    PlaceholderText="https://example.com/header.jpg" VerticalAlignment="Center"
    Text="{x:Bind UpdateProfileViewModel.HeaderUrl, Mode=TwoWay}" Grid.Column="0"/>
            <Button Grid.Column="1" Command="{x:Bind UpdateProfileViewModel.ConfirmHeaderUrlCommand, Mode=OneWay}" VerticalAlignment="Bottom">
                <FontIcon Glyph="&#xE8FB;" />
            </Button>
        </Grid>
        

        <!-- Никнейм -->
        <TextBox
            Header="Отображаемое имя"
            Text="{x:Bind UpdateProfileViewModel.NickName, Mode=TwoWay}"/>

        <Button Content="Сохранить" HorizontalAlignment="Center" Command="{x:Bind UpdateProfileViewModel.UpdateProfileCommand}" VerticalAlignment="Bottom" Padding="12"/>
    </StackPanel>
</ContentDialog>
